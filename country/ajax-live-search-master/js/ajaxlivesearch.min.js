!function(a){"use strict";a.fn.ajaxlivesearch=function(b){function d(a,b){a.hide(),b.find("table").addClass("border_radius")}function e(a,b){b.find("table").removeClass("border_radius"),a.show()}function f(a){var b,c,d=a.find("option");for(c=0;c<d.length;c+=1)void 0===b&&0!==parseInt(d[c].value)?b=d[c].value:parseInt(d[c].value)<parseInt(b)&&0!==parseInt(d[c].value)&&(b=d[c].value);return b}function g(a,b,c){if(void 0===a||void 0===c)throw"Form or Options is missing";var d="."+c.current_page_hidden_class;switch(b){case"result":return a.find("."+c.result_wrapper_class);case"footer":return a.find("."+c.footer_class);case"arrow":return a.find("."+c.arrow_class);case"navigation":return a.find("."+c.navigation_class);case"current_page":return a.find(d);case"current_page_lbl":return a.find("."+c.current_page_lbl_class);case"total_page_lbl":return a.find("."+c.total_page_lbl_class);case"page_range":return a.find("."+c.page_range_class);default:throw"Key: "+b+" is not found"}}function h(a,b){a.slideUp(b.slide_speed)}function i(a,b){a.slideDown(b.slide_speed)}function j(b,j,k,l,m){var n=g(j,"result",k);if(a.trim(b.value).length&&a.trim(b.value).length>=k.min_chars_to_search){if(l||b.latest_value!==b.value){if(m){var o=g(j,"current_page",k),p=g(j,"current_page_lbl",k);o.val("1"),p.html("1")}b.selected_row=void 0,b.to_be_executed&&clearTimeout(b.to_be_executed),b.to_be_executed=setTimeout(function(){if(a.trim(b.value).length){a(b).addClass("ajax_loader");var h=g(j,"navigation",k),l=g(j,"total_page_lbl",k),m=g(j,"page_range",k),o=g(j,"footer",k),p=a(j).serializeArray(),q=a(b).data();a.each(q,function(a,b){var c={};c.name=a,c.value=b,p.push(c)}),a.ajax({type:"post",url:c.url,data:p,dataType:"json",cache:c.cache,success:function(b){if("success"===b.status){var c=a.parseJSON(b.result);if(n.find("table tbody").html(c.html),0===c.number_of_results)d(o,n);else{c.total_pages>1?(h.show(),l.html(c.total_pages)):h.hide();var g=f(m);o.is(":visible")?parseInt(c.number_of_results)<=parseInt(g)?d(o,n):e(o,n):parseInt(c.number_of_results)>parseInt(g)?e(o,n):d(o,n)}}else n.find("table tbody").html(b.message),d(o,n)},error:function(){n.find("table tbody").html("Something went wrong. Please refresh the page."),d(o,n)},complete:function(c){if(a.trim(b.value).length&&n.is(":hidden")&&i(n,k),a(b).removeClass("ajax_loader"),void 0!==k.onAjaxComplete){var d={this:this};k.onAjaxComplete(c,d)}}})}},c.type_delay)}}else(n.is(":visible")||n.is(":animated"))&&h(n,k);b.latest_value=b.value}function k(a,b){var c=a.attr("id");a.attr("autocomplete","off"),a.attr("name","ls_query"),a.addClass("ls_query"),a.attr("maxlength",b.max_input);var e,f,g,d="",h="";for(e=0;e<b.page_ranges.length;e+=1)g=b.page_ranges[e],h=0===g?"All":g,f=b.page_range_default===g?"selected":"",d+='<option value="'+g+'" '+f+">"+h+"</option>";var i='<div class="'+b.footer_class+'"><div class="col '+b.page_limit+'"><select name="ls_items_per_page" class="'+b.page_range_class+'">'+d+'</select></div><div class="col '+b.navigation_class+'"><i class="icon-left-circle '+b.arrow_class+" "+b.previous_page_class+'"></i></div><div class="col '+b.navigation_class+" "+b.pagination_class+'"><label class="'+b.current_page_lbl_class+'">1</label> / <label class="'+b.last_page_lbl_class+'"></label></div><div class="col '+b.navigation_class+'"><i class="icon-right-circle '+b.arrow_class+" "+b.next_page_class+'"></i></div></div>',j='<div class="'+b.container_class+'"><form accept-charset="UTF-8" class="'+b.form_class+'" id="'+b.form_class+"_"+c+'" name="ls_form"></form></div>',k='<input type="hidden" name="ls_anti_bot" class="'+b.form_anti_bot_class+'" value=""><input type="hidden" name="ls_token" class="'+b.token_class+'" value="'+b.token+'"><input type="hidden" name="ls_page_loaded_at" class="'+b.loaded_at_class+'" value="'+b.loaded_at+'"><input type="hidden" name="ls_current_page" class="'+b.current_page_hidden_class+'" value="1"><input type="hidden" name="ls_query_id" value="'+c+'">',l='<div class="'+b.result_wrapper_class+'"><div class="'+b.result_class+'"><table><tbody></tbody></table></div>'+i+"</div>";a.wrap(j),a.before(k),a.after(l)}if(void 0===b.loaded_at)throw"loaded_at must be defined";if(void 0===b.token)throw"token must be defined";var c={url:"core/AjaxProcessor.php",form_anti_bot:"ajaxlivesearch_guard",cache:!1,form_anti_bot_class:"ls_anti_bot",footer_class:"ls_result_footer",next_page_class:"ls_next_page",previous_page_class:"ls_previous_page",page_limit:"page_limit",result_wrapper_class:"ls_result_div",result_class:"ls_result_main",container_class:"ls_container",pagination_class:"pagination",form_class:"search",loaded_at_class:"ls_page_loaded_at",token_class:"ls_token",current_page_hidden_class:"ls_current_page",current_page_lbl_class:"ls_current_page_lbl",last_page_lbl_class:"ls_last_page_lbl",total_page_lbl_class:"ls_last_page_lbl",page_range_class:"ls_items_per_page",page_ranges:[0,5,10],page_range_default:5,navigation_class:"navigation",arrow_class:"arrow",slide_speed:"fast",type_delay:350,max_input:20,min_chars_to_search:0};return c=a.extend(c,b),this.each(function(){var d=a(this),e=d.attr("id");k(d,c);var f=a("#"+c.form_class+"_"+e),l=g(f,"result",c),m=g(f,"arrow",c),n=g(f,"current_page",c),o=g(f,"current_page_lbl",c),p=g(f,"total_page_lbl",c),q=g(f,"page_range",c);d.on("keyup",function(e){var g=e.keyCode||e.which;if(a.trim(d.val()).length&&13===g){if(!l.is(":visible")&&!l.is(":animated")||0===parseInt(l.find("tr").length))i(l,c);else if(void 0!==d.selected_row){var h={selected:a(d.selected_row),this:this,searchField:d};void 0!==b.onResultEnter&&b.onResultEnter(e,h)}}else j(this,f,c,!1,!0)}),d.on("keydown",function(b){var e=b.keyCode||b.which;if(40===e||38===e)return a.trim(d.val()).length&&0!==l.find("tr").length&&(l.is(":visible")||l.is(":animated")?(l.find("tr").removeClass("hover"),void 0===d.selected_row?(d.selected_row=l.find("tr").eq(0),a(d.selected_row).addClass("hover")):(a(d.selected_row).removeClass("hover"),40===e?0===a(d.selected_row).next().length?(d.selected_row=l.find("tr").eq(0),a(d.selected_row).addClass("hover")):(a(d.selected_row).next().addClass("hover"),d.selected_row=a(d.selected_row).next()):0===a(d.selected_row).prev().length?(d.selected_row=l.find("tr").last(),d.selected_row.addClass("hover")):(a(d.selected_row).prev().addClass("hover"),d.selected_row=a(d.selected_row).prev()))):40===e&&i(l,c)),!1}),d.on("focus",function(){a.trim(d.val()).length&&(l.is(":hidden")||l.is(":animated"))&&0!==l.find("tr").length&&(j(this,f,c,!1,!0),i(l,c))}),l.on("mouseover","tr",function(){l.find("tr").removeClass("hover"),d.selected_row=this,a(this).addClass("hover")}),l.on("mouseleave","tr",function(){l.find("tr").removeClass("hover"),d.selected_row=void 0}),f.submit(function(){return!1}),m.on("click",function(){var b;if(a(this).hasClass(c.next_page_class)){if(!(parseInt(n.val(),10)+1<=parseInt(p.html(),10)))return;b=parseInt(n.val(),10)+1}else{if(!(parseInt(n.val(),10)-1>=1))return;b=parseInt(n.val(),10)-1}n.val(b),o.html(b),j(d[0],f,c,!0,!1)}),q.on("change",function(){j(d[0],f,c,!0,!0)}),l.css({left:d.position().left+1,width:d.outerWidth()-2}),a(window).resize(function(){l.css({left:d.position().left+1,width:d.outerWidth()-2})});var r;a(document).bind("touchstart",function(){r=a(window).scrollTop()}).bind("touchend",function(b){var e,f;e=r-a(window).scrollTop(),f=a(document),f.addClass("touched"),e<10&&e>-10&&(a(b.target).closest(l).length||a(b.target).is(d)||!a(l).is(":visible")||h(l,c))}),a(document).on("click",function(b){a(this).hasClass("touched")?a(this).removeClass("touched"):a(b.target).closest(l).length||a(b.target).is(d)||!a(l).is(":visible")||h(l,c)}),a(l).on("click","tr",function(c){var e={selected:a(d.selected_row),this:this,searchField:d};void 0!==b.onResultClick&&b.onResultClick(c,e)}),a(this).on("ajaxlivesearch:hide_result",function(){h(l,c)}),a(this).on("ajaxlivesearch:search",function(b,d){a(this).val(d.query),j(this,f,c,!0,!0)})}),a("."+c.form_anti_bot_class).val(c.form_anti_bot),this}}(jQuery);